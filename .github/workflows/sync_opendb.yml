name: Sync BuildCore OpenDB

on:
  schedule:
    # Runs every day at 02:00 UTC
    - cron: '0 2 * * *'
  workflow_dispatch: # Allows you to manually trigger the workflow from the GitHub UI

jobs:
  update-database:
    runs-on: ubuntu-latest
    
    # Needs permission to push code to your repository
    permissions:
      contents: write

    steps:
      # 1. Checkout your own repository into a folder named 'main-repo'
      - name: Checkout my repository
        uses: actions/checkout@v4
        with:
          path: 'main-repo'

      # 2. Checkout the BuildCore repository
      - name: Checkout BuildCore repository
        uses: actions/checkout@v4
        with:
          repository: 'buildcores/buildcores-open-db' 
          path: 'buildcore-repo'

      # 3. Copy the specific folder you need to your repository
      - name: Sync data to my repository
        run: |
          # Create the target folder in your repository
          mkdir -p main-repo/raw_hardware_data
          
          # Copy the contents from the 'open-db' folder to your folder
          cp -a buildcore-repo/open-db/* main-repo/raw_hardware_data/
          
      # 4. Commit and Push the updated files back to your repository
      - name: Commit and push changes
        run: |
          cd main-repo
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add raw_hardware_data/
          
          # Only commit and push if there are actual changes
          git diff --quiet && git diff --staged --quiet || (git commit -m "Auto-update OpenDB hardware data [skip ci]" && git push)